<!DOCTYPE html>
<html>
  <head>
    <title>Remote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <style>
      html {
        --button-size: min(30vw, 200px);
      }
      .button {
        height: var(--button-size);
        width: var(--button-size);
        background: purple;
        border-radius: 10px;
      }

      .right {
        margin-left: var(--button-size);
      }

      .flexrow {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #log {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div>
      <div class="flexrow">
        <button class="button" data-direction="up"></button>
      </div>
      <div class="flexrow">
        <button class="button" data-direction="left"></button>
        <button class="button right" data-direction="right"></button>
      </div>
      <div class="flexrow">
        <button class="button" data-direction="down"></button>
      </div>
    </div>
    <div id="log"></div>

    <script>
      const socket = new WebSocket(`ws://${location.hostname}/websocket`);

      const logEl = document.getElementById("log");

      // TODO: setInterval heartbeat

      const buttons = document.getElementsByClassName("button");
      for (let button of buttons) {
        const start = event => {
          event.preventDefault();

          const direction = event.currentTarget.dataset.direction;
          console.log(direction, "start");
          socket.send(
            JSON.stringify({ direction: direction, action: "start" })
          );
        };

        button.addEventListener("touchstart", start);
        button.addEventListener("mousedown", start);

        const end = event => {
          const direction = event.currentTarget.dataset.direction;
          console.log(direction, "end");
          socket.send(JSON.stringify({ direction: direction, action: "end" }));
        };

        button.addEventListener("mouseup", end);
        button.addEventListener("touchend", end);
      }

      socket.addEventListener("open", event => {
        logEl.innerText = "Connected!";
      });

      socket.addEventListener("error", event => {
        console.log(event);
        logEl.innerText = "Connection failed :(";
      });
    </script>
  </body>
</html>
